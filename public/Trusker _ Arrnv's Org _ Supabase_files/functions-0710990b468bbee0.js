!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="313e67b0-8b78-4a4e-ae9e-6cac913f5105",e._sentryDebugIdIdentifier="sentry-dbid-313e67b0-8b78-4a4e-ae9e-6cac913f5105")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1753,4986],{41861:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/database/functions",function(){return s(49903)}])},49903:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>H});var n=s(80263),a=s(60045),i=s(53239),l=s(72035),r=s(58642),c=s(83927),o=s.n(c),d=s(75189),u=s(24400),x=s(80535),f=s(93074),h=s(87645),m=s(20313),p=s(88602),j=s(79015),g=s(90437),y=s(92303),N=s(63604),b=s(75019),v=s(86505),w=s(5483),A=s(56776),_=s(86815),S=s(95708),C=s(52786),k=s(91746),E=s(86926),F=s.n(E),L=s(14506),I=s.n(L),P=s(26587),R=s(32137),D=s(89080),T=s(11192),M=s(17089),z=s(40022),$=s(71139);let Q=e=>{let{schema:t,filterString:s,isLocked:i,editFunction:l=o(),deleteFunction:r=o()}=e,c=(0,u.useRouter)(),{data:d}=(0,w.YA)(),x=(0,_.xd)(),{data:f}=(0,y.e)({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString}),m=(null!=f?f:[]).filter(e=>F()(e.name.toLowerCase(),s.toLowerCase())),j=I()(m.filter(e=>e.schema==t),e=>e.name.toLocaleLowerCase()),g=null==d?void 0:d.ref,N=(0,b.SE)(a.aG.TENANT_SQL_ADMIN_WRITE,"functions");return 0===j.length&&0===s.length?(0,n.jsx)(h.A.tr,{children:(0,n.jsxs)(h.A.td,{colSpan:5,children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"No functions created yet"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['There are no functions found in the schema "',t,'"']})]})},t):0===j.length&&s.length>0?(0,n.jsx)(h.A.tr,{children:(0,n.jsxs)(h.A.td,{colSpan:5,children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',s,'" did not return any results']})]})},t):(0,n.jsx)(n.Fragment,{children:j.map(e=>{let s="public"==t&&"trigger"!==e.return_type;return(0,n.jsxs)(h.A.tr,{children:[(0,n.jsx)(h.A.td,{className:"truncate",children:(0,n.jsx)(z.$,{type:"text",className:"text-foreground text-sm p-0 hover:bg-transparent",onClick:()=>l(e),children:e.name})}),(0,n.jsx)(h.A.td,{className:"table-cell overflow-auto",children:(0,n.jsx)("p",{title:e.argument_types,className:"truncate",children:e.argument_types||"-"})}),(0,n.jsx)(h.A.td,{className:"table-cell",children:(0,n.jsx)("p",{title:e.return_type,children:e.return_type})}),(0,n.jsx)(h.A.td,{className:"table-cell",children:e.security_definer?"Definer":"Invoker"}),(0,n.jsx)(h.A.td,{className:"text-right",children:!i&&(0,n.jsx)("div",{className:"flex items-center justify-end",children:N?(0,n.jsxs)($.rI,{children:[(0,n.jsx)($.ty,{asChild:!0,children:(0,n.jsx)(z.$,{"aria-label":"More options",type:"default",className:"px-1",icon:(0,n.jsx)(P.A,{})})}),(0,n.jsxs)($.SQ,{side:"left",className:"w-52",children:[s&&(0,n.jsxs)($._2,{className:"space-x-2",onClick:()=>c.push("/project/".concat(g,"/api?rpc=").concat(e.name)),children:[(0,n.jsx)(R.A,{size:14}),(0,n.jsx)("p",{children:"Client API docs"})]}),(0,n.jsxs)($._2,{className:"space-x-2",onClick:()=>l(e),children:[(0,n.jsx)(D.A,{size:14}),(0,n.jsx)("p",{children:"Edit function"})]}),(0,n.jsxs)($._2,{className:"space-x-2",onClick:()=>{x.newChat({name:"Update function ".concat(e.name),open:!0,initialInput:"Update this function to do...",suggestions:{title:"I can help you make a change to this function, here are a few example prompts to get you started:",prompts:[{label:"Rename Function",description:"Rename this function to ..."},{label:"Modify Function",description:"Modify this function so that it ..."},{label:"Add Trigger",description:"Add a trigger for this function that calls it when ..."}]},sqlSnippets:[e.complete_statement]})},children:[(0,n.jsx)(T.A,{size:14}),(0,n.jsx)("p",{children:"Edit function with Assistant"})]}),(0,n.jsx)($.mB,{}),(0,n.jsxs)($._2,{className:"space-x-2",onClick:()=>r(e),children:[(0,n.jsx)(M.A,{size:14,className:"text-destructive"}),(0,n.jsx)("p",{children:"Delete function"})]})]})]}):(0,n.jsx)(p.G,{disabled:!0,type:"default",icon:(0,n.jsx)(P.A,{}),className:"px-1",tooltip:{content:{side:"left",text:"You need additional permissions to update functions"}}})})})]},e.id)})})},U=e=>{let{createFunction:t=o(),editFunction:s=o(),deleteFunction:i=o()}=e,l=(0,u.useRouter)(),{search:r}=(0,x.g)(),{data:c}=(0,w.YA)(),E=(0,_.xd)(),{selectedSchema:F,setSelectedSchema:L}=(0,v.k)(),I=null!=r?r:"",P=e=>{let t=new URL(document.URL);""===e?t.searchParams.delete("search"):t.searchParams.set("search",e),l.push(t)},R=(0,b.SE)(a.aG.TENANT_SQL_ADMIN_WRITE,"functions"),{data:D}=(0,N.w$)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString}),{isSchemaLocked:T}=(0,A.BQ)({schema:F}),{data:M,error:z,isLoading:$,isError:U}=(0,y.e)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString});return $?(0,n.jsx)(g.y,{}):U?(0,n.jsx)(m.A,{error:z,subject:"Failed to retrieve database functions"}):(0,n.jsx)(n.Fragment,{children:0==(null!=M?M:[]).length?(0,n.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,n.jsxs)(f.A,{title:"Functions",ctaButtonLabel:"Create a new function",onClickCta:()=>t(),disabled:!R,disabledMessage:"You need additional permissions to create functions",children:[(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"PostgreSQL functions, also known as stored procedures, is a set of SQL and procedural commands such as declarations, assignments, loops, flow-of-control, etc."}),(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"It's stored on the database server and can be invoked using the SQL interface."})]})}):(0,n.jsxs)("div",{className:"w-full space-y-4",children:[(0,n.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-2 flex-wrap",children:[(0,n.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:[(0,n.jsx)(j.A,{className:"w-full lg:w-[180px]",size:"tiny",showError:!1,selectedSchemaName:F,onSelectSchema:e=>{let t=new URL(document.URL);t.searchParams.delete("search"),l.push(t),L(e)}}),(0,n.jsx)(S.A,{placeholder:"Search for a function",size:"tiny",icon:(0,n.jsx)(d.A,{size:14}),value:I,className:"w-full lg:w-52",onChange:e=>P(e.target.value)})]}),(0,n.jsx)("div",{className:"flex items-center gap-x-2",children:!T&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p.G,{disabled:!R,onClick:()=>t(),className:"flex-grow",tooltip:{content:{side:"bottom",text:R?void 0:"You need additional permissions to create functions"}},children:"Create a new function"}),(0,n.jsx)(p.G,{type:"default",disabled:!R,className:"px-1 pointer-events-auto",icon:(0,n.jsx)(C.M,{size:16}),onClick:()=>E.newChat({name:"Create new function",open:!0,initialInput:"Create a new function for the schema ".concat(F," that does ...")}),tooltip:{content:{side:"bottom",text:R?"Create with Supabase Assistant":"You need additional permissions to create functions"}}})]})})]}),T&&(0,n.jsx)(k.i,{schema:F,entity:"functions"}),(0,n.jsx)(h.A,{className:"table-fixed overflow-x-auto",head:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(h.A.th,{children:"Name"},"name"),(0,n.jsx)(h.A.th,{className:"table-cell",children:"Arguments"},"arguments"),(0,n.jsx)(h.A.th,{className:"table-cell",children:"Return type"},"return_type"),(0,n.jsx)(h.A.th,{className:"table-cell w-[100px]",children:"Security"},"security"),(0,n.jsx)(h.A.th,{className:"w-1/6"},"buttons")]}),body:(0,n.jsx)(Q,{schema:F,filterString:I,isLocked:T,editFunction:s,deleteFunction:i})})]})})};var Y=s(46221),G=s(65216),q=s(92882),O=s(34618),W=s(92512),B=s(98969);let V=()=>{let[e,t]=(0,i.useState)(),[s,c]=(0,i.useState)(!1),[o,d]=(0,i.useState)(!1),u=(0,l.h4)(),[x,f]=(0,i.useState)(!1),[h,m]=(0,i.useState)(),p=(0,b.SE)(a.aG.TENANT_SQL_ADMIN_READ,"functions");return(0,b.Lh)()&&!p?(0,n.jsx)(B.A,{isFullPage:!0,resourceText:"view database functions"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(q.eh,{"data-sentry-element":"ScaffoldContainer","data-sentry-source-file":"functions.tsx",children:(0,n.jsx)(q.gu,{"data-sentry-element":"ScaffoldSection","data-sentry-source-file":"functions.tsx",children:(0,n.jsxs)("div",{className:"col-span-12",children:[(0,n.jsx)(W.M,{title:"Database Functions",docsUrl:"https://supabase.com/docs/guides/database/functions","data-sentry-element":"FormHeader","data-sentry-source-file":"functions.tsx"}),(0,n.jsx)(U,{createFunction:()=>{u?(m(void 0),f(!0)):(t(void 0),c(!0))},editFunction:e=>{u?(m(e),f(!0)):(t(e),c(!0))},deleteFunction:e=>{t(e),d(!0)},"data-sentry-element":"FunctionsList","data-sentry-source-file":"functions.tsx"})]})})}),(0,n.jsx)(r.ZO,{func:e,visible:s,setVisible:c,"data-sentry-element":"CreateFunction","data-sentry-source-file":"functions.tsx"}),(0,n.jsx)(r.iZ,{func:e,visible:o,setVisible:d,"data-sentry-element":"DeleteFunction","data-sentry-source-file":"functions.tsx"}),(0,n.jsx)(O.E,{open:x,onRunSuccess:()=>{f(!1),m(void 0)},onClose:()=>{f(!1),m(void 0)},initialValue:h?h.complete_statement:"create function function_name()\nreturns void\nlanguage plpgsql\nas $$\nbegin\n  -- Write your function logic here\nend;\n$$;",label:h?'Edit function "'.concat(h.name,'"'):"Create new database function",initialPrompt:h?'Update the database function "'.concat(h.name,'" to...'):"Create a new database function that...","data-sentry-element":"EditorPanel","data-sentry-source-file":"functions.tsx"})]})};V.getLayout=e=>(0,n.jsx)(G.A,{children:(0,n.jsx)(Y.A,{title:"Database",children:e})});let H=V},55315:(e,t,s)=>{var n=s(71057);e.exports=function(e,t){return n(t,function(t){return e[t]})}},61741:(e,t,s)=>{var n=s(55315),a=s(24967);e.exports=function(e){return null==e?[]:n(e,a(e))}},86926:(e,t,s)=>{var n=s(35902),a=s(89527),i=s(22442),l=s(80544),r=s(61741),c=Math.max;e.exports=function(e,t,s,o){e=a(e)?e:r(e),s=s&&!o?l(s):0;var d=e.length;return s<0&&(s=c(d+s,0)),i(e)?s<=d&&e.indexOf(t,s)>-1:!!d&&n(e,t,s)>-1}},89080:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});let n=(0,s(15740).A)("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]])},92303:(e,t,s)=>{"use strict";s.d(t,{e:()=>o});var n=s(47319),a=s(56947),i=s(92403),l=s(15629);let r=n.A.functions.list();async function c(e,t,s){let{projectRef:n,connectionString:a}=e,i=new Headers(s),{result:c}=await (0,l.E)({projectRef:n,connectionString:a,sql:r.sql,queryKey:["database-functions"]},t,i);return c}let o=function(e){let{projectRef:t,connectionString:s}=e,{enabled:n=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)(i.c.databaseFunctions(t),e=>{let{signal:n}=e;return c({projectRef:t,connectionString:s},n)},{enabled:n&&void 0!==t,...l})}},93074:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var n=s(80263),a=s(23445),i=s(88602),l=s(15601),r=s.n(l),c=s(40022);let o=e=>{let{title:t="",size:s="medium",children:l,ctaButtonLabel:o="",infoButtonLabel:d="",infoButtonUrl:u="",onClickCta:x=()=>{},loading:f=!1,disabled:h=!1,disabledMessage:m="",ctaUrl:p}=e,j=o&&x||u&&d;return(0,n.jsx)("div",{className:"flex h-full w-full items-center justify-center","data-sentry-component":"ProductEmptyState","data-sentry-source-file":"ProductEmptyState.tsx",children:(0,n.jsx)("div",{className:"flex space-x-4 rounded border bg-surface-100 p-6 shadow-md",children:(0,n.jsx)("div",{className:"flex flex-col",children:(0,n.jsxs)("div",{className:"".concat("medium"===s?"w-80":"w-[400px]"," space-y-4"),children:[(0,n.jsx)("h5",{className:"text-foreground",children:t}),(0,n.jsx)("div",{className:"flex flex-col space-y-2 text-foreground-light",children:l}),j&&(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[o&&p?(0,n.jsx)(c.$,{asChild:!0,type:"primary",children:(0,n.jsx)(r(),{href:p,children:o})}):o&&x?(0,n.jsx)(i.G,{type:"primary",onClick:x,loading:f,disabled:f||h,tooltip:{content:{side:"bottom",text:h&&m.length>0?m:void 0}},children:o}):null,u&&d?(0,n.jsx)(c.$,{type:"default",icon:(0,n.jsx)(a.A,{strokeWidth:1.5}),children:(0,n.jsx)("a",{target:"_blank",rel:"noreferrer",href:u,children:d})}):null]})]})})})})}},98969:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var n=s(80263),a=s(87610);let i=e=>{let{resourceText:t,isFullPage:s=!1}=e,i=()=>(0,n.jsx)("div",{className:"block w-full rounded border border-opacity-20 py-4 px-6 border-overlay bg-surface-200","data-sentry-component":"NoPermissionMessage","data-sentry-source-file":"NoPermission.tsx",children:(0,n.jsxs)("div",{className:"flex space-x-3",children:[(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)(a.A,{size:20,"data-sentry-element":"AlertCircle","data-sentry-source-file":"NoPermission.tsx"})}),(0,n.jsx)("div",{className:"flex w-full items-center justify-between",children:(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsxs)("p",{className:"text-sm",children:["You need additional permissions to ",t]}),(0,n.jsx)("div",{children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Contact your organization owner or administrator for assistance."})})]})})]})});return s?(0,n.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,n.jsx)("div",{className:"w-[550px]",children:(0,n.jsx)(i,{})})}):(0,n.jsx)(i,{})}}},e=>{var t=t=>e(e.s=t);e.O(0,[89,2313,4335,726,4280,3730,7494,9014,6110,386,4915,4024,5599,7795,7326,1680,4156,9107,319,4400,2535,4017,5038,4444,279,7434,1715,1072,1099,5216,5756,1190,7737,8742,3374,3258,636,6593,8792],()=>t(41861)),_N_E=e.O()}]);